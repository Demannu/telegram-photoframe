(this["webpackJsonpphotoframe-react"]=this["webpackJsonpphotoframe-react"]||[]).push([[0],{33:function(t,e,n){},34:function(t,e,n){"use strict";n.r(e);var a=n(1),i=n(0),r=n.n(i),o=n(15),c=n.n(o),s=n(2),u=n.n(s),d=n(5),l=n(3),p=n(16),h=n.n(p),f=n.p+"static/media/logo.eea735da.png",b=l.a.div({display:"grid",placeItems:"center"});function j(t){var e=t.event,n=t.client,i=r.a.useRef();return r.a.useEffect((function(){function t(){return(t=Object(d.a)(u.a.mark((function t(){var a,r;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=e.authorization_state["@type"],t.t0=a,t.next="authorizationStateWaitEncryptionKey"===t.t0?4:"authorizationStateClosed"===t.t0||"authorizationStateWaitPhoneNumber"===t.t0?7:"authorizationStateWaitOtherDeviceConfirmation"===t.t0?10:14;break;case 4:return t.next=6,n.send({"@type":"checkDatabaseEncryptionKey"});case 6:return t.abrupt("break",15);case 7:return t.next=9,n.send({"@type":"requestQrCodeAuthentication",other_user_ids:[]});case 9:return t.abrupt("break",15);case 10:return r=new h.a({width:400,height:400,data:e.authorization_state.link,image:f,dotsOptions:{color:"#25abec",type:"square"},backgroundOptions:{color:"transparent"},imageOptions:{crossOrigin:"anonymous",margin:20}}),i.current.innerHTML="",r.append(i.current),t.abrupt("break",15);case 14:return t.abrupt("break",15);case 15:case"end":return t.stop()}}),t)})))).apply(this,arguments)}n&&(null===e||void 0===e?void 0:e.authorization_state)&&function(){t.apply(this,arguments)}()}),[n,e]),Object(a.jsxs)(b,{children:[Object(a.jsx)("h1",{children:"Login with your device"}),Object(a.jsx)("div",{ref:i})]})}var v=n(4),m=n(6),y=n(13),g=l.a.button({padding:10,border:"none",font:"inherit",color:"inherit",backgroundColor:"light-grey",borderRadius:"50%",height:50,width:50,fontSize:"1.5rem",margin:5});function x(t){var e=t.client,n=t.text,i=t.children,r=Object(y.a)("/pop-down.mp3",{volume:.25}),o=Object(v.a)(r,1)[0],c=Object(y.a)("/pop-up-on.mp3",{volume:.25}),s=Object(v.a)(c,1)[0];return Object(a.jsx)(g,{onMouseDown:o,onMouseUp:function(t){s(),function(t){e.send({"@type":"sendMessage",chat_id:-440888561,reply_to_message_id:0,input_message_content:{"@type":"inputMessageText",text:{"@type":"formattedText",text:t,entities:[]}}})}(n)},children:i})}var O=n(21),_=n(7),w=n(20),C=n.n(w),S=r.a.createContext();function k(t){var e=r.a.useState(),n=Object(v.a)(e,2),i=n[0],o=n[1],c=r.a.useState(),s=Object(v.a)(c,2),l=s[0],p=s[1],h=r.a.useRef(),f=r.a.useState(),b=Object(v.a)(f,2),j=b[0],m=b[1],y=r.a.useState([]),g=Object(v.a)(y,2),x=g[0],w=g[1],k=function(){var t=Object(d.a)(u.a.mark((function t(e){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.send({"@type":"downloadFile",file_id:e,priority:1,synchronous:!0});case 2:return t.next=4,i.send({"@type":"readFile",file_id:e});case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),z=r.a.useCallback((function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;i.send({"@type":"getChatHistory",chat_id:t,limit:100,from_message_id:e}).then((function(t){return w((function(e){var n=new Set([].concat(Object(_.a)(e),Object(_.a)(t.messages)));return Array.from(n).sort((function(t,e){return t.date-e.date}))}))}))}),[i]),I=r.a.useCallback((function(t){"updateAuthorizationState"===t["@type"]&&m(t),"updateNewMessage"!==t["@type"]&&"updateDeleteMessages"!==t["@type"]||function(t){var e;switch(t["@type"]){case"updateNewMessage":(null===t||void 0===t||null===(e=t.message)||void 0===e?void 0:e.chat_id)===h.current&&w((function(e){return[].concat(Object(_.a)(e),[null===t||void 0===t?void 0:t.message])}));break;case"updateDeleteMessages":t.chat_id===h.current&&t.message_ids.forEach(function(){var t=Object(d.a)(u.a.mark((function t(e){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:w((function(t){return t.filter((function(t){return t.id!==e}))}));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}(t)}),[]);return r.a.useEffect((function(){console.log("Initializing tdlib");var t=new C.a({useTestDC:!1,readOnly:!1,verbosity:3,jsVerbosity:3,fastUpdating:!0,useDatabase:!1,mode:"wasm"});t.onUpdate=I,o(t)}),[I]),r.a.useEffect((function(){i&&i.send({"@type":"setTdlibParameters",parameters:{"@type":"tdParameters",use_test_dc:!1,api_id:"10726",api_hash:"f896fe83f2e0a25b99b44c9aad2421f3",system_language_code:navigator.language||"en",device_model:"Telegram Frame",application_version:"0.1",use_secret_chats:!1,use_message_database:!1,use_file_database:!1,files_directory:"/"}})}),[i]),r.a.useEffect((function(){function t(){return(t=Object(d.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.send({"@type":"getChats",chat_list:{"@type":"chatListMain"},offset_order:"9223372036854775807",offset_chat_id:l,limit:1});case 2:return t.next=4,z(l);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}i&&l&&(h.current=l,function(){t.apply(this,arguments)}())}),[i,l,z]),Object(a.jsx)(S.Provider,Object(O.a)({value:{client:i,chatId:l,setChatId:p,event:j,history:x,getChatHistory:z,downloadFile:k}},t))}function z(){var t=r.a.useContext(S);if(void 0===t)throw new Error("useTdlib must be used within a TelegramProvider");return t}var I=l.a.div.withConfig({displayName:"Slideshow__Container",componentId:"dxjitx-0"})({overflow:"hidden",height:600,width:1024,cursor:"none"}),E=l.a.div.withConfig({displayName:"Slideshow__Picture",componentId:"dxjitx-1"})((function(t){var e=t.blob;return{width:"100%",height:600,backgroundImage:"url(".concat(e,")"),backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundSize:"cover"}})),L=l.a.div.withConfig({displayName:"Slideshow__Caption",componentId:"dxjitx-2"})({position:"relative",top:-60,left:"2%",color:"white",fontSize:"2rem"}),P=l.a.div.withConfig({displayName:"Slideshow__Reactions",componentId:"dxjitx-3"})({position:"relative",top:-120,left:"85%",display:"flex",flexDirection:"row"});function R(){var t=z(),e=t.client,n=t.chatId,i=t.history,o=t.getChatHistory,c=t.downloadFile,s=r.a.useState([]),l=Object(v.a)(s,2),p=l[0],h=l[1],f=r.a.useState(""),b=Object(v.a)(f,2),j=b[0],y=b[1];return r.a.useEffect((function(){function t(){return(t=Object(d.a)(u.a.mark((function t(){var e,r,s,d,l,p,f,b,j,v,g,x,O,_,w;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(d=i.filter((function(t){var e;return["messagePhoto","messageVideo"].includes(null===t||void 0===t||null===(e=t.content)||void 0===e?void 0:e["@type"])})),!Object(m.isEmpty)(d)){t.next=4;break}return o(n,null===(l=Object(m.first)(i))||void 0===l?void 0:l.id),t.abrupt("return");case 4:p=Object(m.last)(d),t.t0=null===p||void 0===p||null===(e=p.content)||void 0===e?void 0:e["@type"],t.next="messagePhoto"===t.t0?8:"messageVideo"===t.t0?18:27;break;case 8:return f=p.content.photo,b=Object(m.last)(f.sizes),j=b.photo.id,t.next=13,c(j);case 13:return v=t.sent,g=URL.createObjectURL(v.data),h(Object(a.jsx)(E,{"data-testid":j,blob:g})),y(null===(r=p.content)||void 0===r?void 0:r.text),t.abrupt("break",28);case 18:return x=p.content.video,O=x.video.id,t.next=22,c(O);case 22:return _=t.sent,w=URL.createObjectURL(_.data),h(Object(a.jsx)("video",{"data-testid":O,src:w,controls:!0,autoPlay:!0})),y(null===(s=p.content)||void 0===s?void 0:s.text),t.abrupt("break",28);case 27:return t.abrupt("break",28);case 28:case"end":return t.stop()}}),t)})))).apply(this,arguments)}console.log("Received a new history",i),Object(m.isEmpty)(i)||function(){t.apply(this,arguments)}()}),[e,i,n,o,c]),Object(m.isEmpty)(i)?Object(a.jsx)("div",{children:Object(a.jsx)("span",{children:"There are no pictures in this chat."})}):Object(a.jsxs)(I,{children:[p,Object(a.jsx)(L,{children:j}),Object(a.jsxs)(P,{children:[Object(a.jsx)(x,{client:e,text:"\u2665\ufe0f",children:"\u2665\ufe0f"}),Object(a.jsx)(x,{client:e,text:"\ud83e\udd70",children:"\ud83e\udd70"})]})]})}var M=l.a.div.withConfig({displayName:"EmptyChat__Container",componentId:"jss9dm-0"})({display:"grid",placeItems:"center",height:"100vh"}),N=l.a.div.withConfig({displayName:"EmptyChat__ChatPicture",componentId:"jss9dm-1"})((function(t){var e=t.src;return{height:400,width:400,borderRadius:"50%",backgroundImage:"url(".concat(e,")"),backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundSize:"cover"}})),F=l.a.div.withConfig({displayName:"EmptyChat__Message",componentId:"jss9dm-2"})({fontSize:"2rem"});function D(t){var e=t.chatId,n=z().client,i=r.a.useState(null),o=Object(v.a)(i,2),c=o[0],s=o[1],l=r.a.useState(null),p=Object(v.a)(l,2),h=p[0],f=p[1];return r.a.useEffect((function(){var t=!0;function a(){return(a=Object(d.a)(u.a.mark((function a(){var i,r,o,c,d,l;return u.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,n.send({"@type":"getChats",chat_list:{"@type":"chatListMain"},offset_order:"9223372036854775807",offset_chat_id:e,limit:1});case 2:return a.next=4,n.send({"@type":"getChat",chat_id:e});case 4:if(o=a.sent,!(c=null===o||void 0===o||null===(i=o.photo)||void 0===i||null===(r=i.big)||void 0===r?void 0:r.id)){a.next=14;break}return a.next=9,n.send({"@type":"downloadFile",file_id:c,priority:16,synchronous:!0});case 9:return a.next=11,n.send({"@type":"readFile",file_id:c});case 11:d=a.sent,l=URL.createObjectURL(d.data),t&&(s(o.title),f(l));case 14:case"end":return a.stop()}}),a)})))).apply(this,arguments)}return function(){a.apply(this,arguments)}(),function(){return t=!1}}),[n,e]),Object(a.jsxs)(M,{children:[Object(a.jsx)(N,{src:h}),Object(a.jsxs)(F,{children:["Send a picture to '",c,"' to view it here"]})]})}var T=l.a.div.withConfig({displayName:"ChatSelection__ListContainer",componentId:"sc-1r1tjet-0"})({scrollDirection:"horizontal"}),U=l.a.ul.withConfig({displayName:"ChatSelection__List",componentId:"sc-1r1tjet-1"})({listStyle:"none",margin:0,padding:0}),W=l.a.li.withConfig({displayName:"ChatSelection__Chat",componentId:"sc-1r1tjet-2"})({padding:10,fontSize:"2rem","&:nth-child(odd)":{background:"#ccc"}});function A(){var t=z(),e=t.client,n=t.setChatId,i=r.a.useState([]),o=Object(v.a)(i,2),c=o[0],s=o[1];return r.a.useEffect((function(){function t(){return(t=Object(d.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.send({"@type":"getChats",chat_list:{"@type":"chatListMain"},offset_order:"9223372036854775807",offset_chat_id:0,limit:10});case 2:t.sent.chat_ids.map(function(){var t=Object(d.a)(u.a.mark((function t(n){var a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.send({"@type":"getChat",chat_id:n});case 2:a=t.sent,s((function(t){return[].concat(Object(_.a)(t),[{id:n,title:a.title}])}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[e]),Object(a.jsxs)(T,{children:[Object(a.jsx)("h1",{children:"Select a chat to use as Frame:"}),Object(a.jsx)(U,{children:c.map((function(t){return Object(a.jsx)(W,{onClick:function(e){return n(t.id)},children:t.title},t.id)}))})]})}function H(){var t=z(),e=t.chatId,n=t.history;return e?Object(m.isEmpty)(n)?Object(a.jsx)(D,{chatId:e}):Object(a.jsx)(R,{}):Object(a.jsx)(A,{})}n(32),n(33);var K=function(){var t=z(),e=t.client,n=t.event,i=t.updates;if(!n||!n.authorization_state)return Object(a.jsx)("div",{children:"Loading..."});switch(n.authorization_state["@type"]){case"authorizationStateWaitEncryptionKey":case"authorizationStateWaitOtherDeviceConfirmation":case"authorizationStateWaitPhoneNumber":case"updateAuthorizationState":case"authorizationStateClosed":return Object(a.jsx)(j,{event:n,client:e});case"authorizationStateReady":return Object(a.jsx)(H,{updates:i,client:e});default:return null}},V=function(t){t&&t instanceof Function&&n.e(4).then(n.bind(null,36)).then((function(e){var n=e.getCLS,a=e.getFID,i=e.getFCP,r=e.getLCP,o=e.getTTFB;n(t),a(t),i(t),r(t),o(t)}))};c.a.render(Object(a.jsx)(r.a.StrictMode,{children:Object(a.jsx)(k,{children:Object(a.jsx)(K,{})})}),document.getElementById("root")),V()}},[[34,1,2]]]);
//# sourceMappingURL=main.e73164f0.chunk.js.map